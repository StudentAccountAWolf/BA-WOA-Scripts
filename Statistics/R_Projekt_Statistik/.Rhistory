library(pROC)                   # Evaluation metrics
library(PRROC)                  # Evaluation metrics
library(multiROC)               # Evaluation metrics
#library(chemodiv)               # Chemodiversity (Petren 2022)
#library(rcdk)                   # CDK
#library(Rcpi)                   # Molecular descriptors
#library(rinchi)                 # Converting SMILES to InchiKey
library(plotly)                 # For creating html plots
library(htmlwidgets)            # For creating html plots
library(shiny)                  # HTML in R
#library(sunburstR)              # HTML-sunburst plots
library(heatmaply)              # HTML heatmaps
library(phytools)               # For phylogeny analyses
library(ape)                    # For phylogeny analyses
library(treeio)                 # For phylogeny analyses
library(ggfortify)              # For plotting
#library(rentrez)                # For searching Genbank
library(rpart)                  # For decision/regression trees
library(rpart.plot)             # For decision/regression trees
library(rattle)                 # For decision/regression trees
library(party)                  # For conditional decision trees
# Laden Sie das 'renv' Paket
library(renv)
# Funktion, um Abh채ngigkeiten zu ermitteln
get_dependencies <- function(project_path) {
# Setzen Sie den Pfad zum Projektverzeichnis
setwd(project_path)
# Ermitteln Sie die Abh채ngigkeiten
dependencies <- renv::dependencies()
# Erstellen Sie ein Dataframe mit den Paketnamen und den Dateien, in denen sie gefunden wurden
dep_df <- data.frame(Package = dependencies$Package, File = dependencies$Source)
# R체ckgabe des Dataframes
return(dep_df)
}
# Verwendung der Funktion
# Ersetzen Sie 'path/to/your/project' mit dem tats채chlichen Pfad zu Ihrem Projekt
project_path <- 'M:/Programmieren/Arbeitsordner/Learning/Statistics'
dep_df <- get_dependencies(project_path)
# Ausgabe der ermittelten Pakete
print(dep_df)
#-------------------------------------------------------------------------------
print_package_versions <- function() {
# List of packages
packages <- c(
"ape", "caret", "cba", "foreach", "ggfortify", "ggplot2", "ggtree", "gplots",
"heatmaply", "Hmisc", "htmlwidgets", "multcomp", "multiROC", "parallel",
"party", "phangorn", "phytools", "plotly", "pls", "pROC", "PRROC", "pvclust",
"randomForest", "rattle", "RColorBrewer", "rotl", "rpart", "rpart.plot",
"shiny", "treeio", "vegan", "adabag", "base", "bnclassify", "Boruta",
"circlize", "doParallel", "dummies", "e1071", "httr", "lmerTest", "mixOmics",
"mlr", "mltest", "multcomp", "naivebayes", "ontologyIndex", "plotrix",
"ropls", "scales"
)
# Initialize empty vector to store results
versions <- character(length(packages))
# Loop through packages and get version
for (i in seq_along(packages)) {
if (requireNamespace(packages[i], quietly = TRUE)) {
vers <- packageVersion(packages[i])
if (is.list(vers)) {
# If multiple versions are installed, take the first one
versions[i] <- paste0('"', packages[i], " ", vers[[1]], '"')
} else {
versions[i] <- paste0('"', packages[i], " ", vers, '"')
}
} else {
versions[i] <- NA
}
}
# Print results
for (j in seq_along(packages)) {
cat(versions[j], "\n")
}
}
# ---------- RDA ----------
# Format BET data matrix
bet_species <- rbind(bet_species[1:5,], bet_species[5,], bet_species[6:7,])
bet_species$friendly_name <- c("B. rutabulum", "G. pulvinata", "H. lutescens", "H. cupressiforme", "P. undulatum (f)", "P. undulatum (m)", "Bryum sp.", "R. squarrosus")
# Replicate species according to each sample
bet_traits <- data.frame()
for (i in 1:nrow(leaf_traits)) {
bet_traits <- rbind(bet_traits, bet_species[which(species_samples_leaf[i] == bet_species$friendly_name), ])
}
bet_traits <- as.data.frame(bet_traits)
# Only take bioclimatic traits
bet_traits <- bet_traits[, c(76:93)]
# Make numeric each column
for (i in 1:ncol(bet_traits)) {
if (! any(is.na(as.numeric(bet_traits[, i])))) {
bet_traits[, i] <- abs(as.numeric(bet_traits[, i]))
} else {
bet_traits[, i] <- as.numeric(as.factor(bet_traits[, i]))
}
}
bet_traits[is.na(bet_traits)] <- 0
# Scale matrix
bet_traits <- as.data.frame(scale(bet_traits, scale=TRUE, center=FALSE))
# Create formula
attach(bet_traits)
bet_traits_rda_formula <- formula(paste0("~ 0 + ", paste0(colnames(bet_traits),collapse=" + ")))
bet_traits_rda_y <- data.frame(model.matrix(bet_traits_rda_formula))
detach(bet_traits)
# Calculate overlay of descriptors on leaf traits distances
model_leaf_traits_dbrda <- dbrda(formula=scale(leaf_traits[,8:36]) ~ ., data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
model_leaf_traits_dbrda_scores <- vegan::scores(model_leaf_traits_dbrda)
model_leaf_traits_dbrda_ef_descriptors <- envfit(model_leaf_traits_dbrda, bet_traits, perm=10000)
# Goodness of fit statistic: Squared correlation coefficient
model_leaf_traits_dbrda_fit_descriptors <- data.frame(r2=c(model_leaf_traits_dbrda_ef_descriptors$vectors$r,model_leaf_traits_dbrda_ef_descriptors$factors$r),
pvals=c(model_leaf_traits_dbrda_ef_descriptors$vectors$pvals,model_leaf_traits_dbrda_ef_descriptors$factors$pvals) )
rownames(model_leaf_traits_dbrda_fit_descriptors) <- c(names(model_leaf_traits_dbrda_ef_descriptors$vectors$r),names(model_leaf_traits_dbrda_ef_descriptors$factors$r))
model_leaf_traits_dbrda_fit_descriptors
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.75, p.max=1, col="black")
# Model with intercept only
model_0_leaf_traits_rda <- vegan::dbrda(formula=scale(leaf_traits[,8:36]) ~ 1, data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
# Model with all explanatory variables
model_1_leaf_traits_rda <- vegan::dbrda(formula=scale(leaf_traits[,8:36]) ~ ., data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
# Stepwise forward selection
model_step_leaf_traits_rda <- ordistep(object=model_0_leaf_traits_rda, scope=formula(model_1_leaf_traits_rda), R2scope=TRUE, trace=TRUE, Pin=0.05, Pout=0.5, direction="forward", perm.max=10000)
model_step_leaf_traits_rda_scores <- vegan::scores(model_step_leaf_traits_rda)
# dbRDA with selected model by permutation tests in constrained ordination
model_leaf_traits_rda <- vegan::dbrda(formula=as.formula(model_step_leaf_traits_rda$terms), data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
model_leaf_traits_rda_ef_formula <- update(as.formula(model_step_leaf_traits_rda$terms), model_leaf_traits_rda ~ .)
View(model_leaf_traits_rda_ef)
View(model_leaf_traits_dbrda_ef_descriptors)
model_leaf_traits_dbrda_ef_descriptors
legend("topleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.75, p.max=1, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black",loadings.label.hjust=-1, loadings.label.vjust=1, loadings.label.repel=TRUE)
# classic plot
plot(model_pca_leaf$x[, 1], model_pca_leaf$x[, 2], pch=19, main="PCA",
xlab=paste0("PC1: ", format(summary(model_pca_leaf)$importance[2, 1] * 100, digits=3), " % variance"),
ylab=paste0("PC2: ", format(summary(model_pca_leaf)$importance[2, 2] * 100, digits=3), " % variance"),
col=species_colors_samples_leaf, cex=2)
#grid()
#text(model_pca_leaf$x[, 1], model_pca_leaf$x[, 2], labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.8)
legend("topleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
# explained variance
screeplot(model_pca_leaf, bstick=TRUE, type=c("barplot", "lines"), npcs=min(20, length(model_pca_leaf$sdev)), ptype="o", bst.col="red", bst.lty="solid", xlab="Component", ylab="Inertia", main="Broken stick test of PCA", legend=TRUE)
# ggplot
autoplot(model_pca_leaf, data=leaf_traits, size=3, color=species_colors_samples_leaf,
loadings=TRUE, loadings.color="black",
loadings.label=TRUE, loadings.label.hjust=-1, loadings.label.vjust=1, loadings.label.repel=TRUE, loadings.label.size=4.2, loadings.label.color="black",loadings.arrow.size=5 ) +
theme(panel.grid.minor=element_line(color="lightgrey", size=0.25, linetype=3),
panel.grid.major=element_line(color="grey", size=0.5, linetype=3),
panel.background=element_blank(),
panel.border=element_rect(color="black", fill=NA, size=1) ) +
scale_color_manual(values=as.character(species_colors_samples_leaf), labels=gsub(x=species_colors, pattern="\\.", replacement="\\. ")) +
scale_fill_manual(values=as.character(species_colors_samples_leaf)) +
guides(shape=guide_legend(override.aes=list(size=1))) +
theme(legend.position='bottom', legend.direction='vertical', plot.title=element_text(hjust=0.5), axis.title = element_text(size = 13), axis.text = element_text(size = 12)) +
labs(title="PCA of most significant leaf traits", title.fontface="bold", x=paste0("PC1: ", format(summary(model_pca_leaf)$importance[2, 1] * 100, digits=3), " % variance"), y=paste0("PC2: ", format(summary(model_pca_leaf)$importance[2, 2] * 100, digits=3), " % variance"))
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=0.8, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=0.8, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=0.5, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=3, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=3, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
# Use the pointLabel function to place labels without overlapping
pointLabel(x = model_leaf_traits_dbrda_scores$sites[,1],
y = model_leaf_traits_dbrda_scores$sites[,2],
labels = rownames(model_leaf_traits_dbrda_scores$sites),
cex = 0.7, col = species_colors_samples_leaf, method = "SANN")
install.packages("maptools")
library(maptools)
install.packages("maptools")
library(maptools)
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
text(model_leaf_traits_dbrda_scores$sites[,1],
model_leaf_traits_dbrda_scores$sites[,2],
labels = rownames(model_leaf_traits_dbrda_scores$sites),
col = species_colors_samples_leaf,
pos = 4, offset = 0.5, cex = 0.7)
# Alternatively, you can add labels with different positions for better separation
for (i in 1:nrow(model_leaf_traits_dbrda_scores$sites)) {
x <- model_leaf_traits_dbrda_scores$sites[i, 1]
y <- model_leaf_traits_dbrda_scores$sites[i, 2]
label <- rownames(model_leaf_traits_dbrda_scores$sites)[i]
# Adjust position based on conditions, you can add more conditions for better separation
if (i %% 2 == 0) {
pos <- 3 # Above
} else {
pos <- 1 # Below
}
text(x, y, labels = label, col = species_colors_samples_leaf[i], pos = pos, offset = 0.5, cex = 0.7)
}
# Plot the environmental descriptors
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=3, col="black")
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=3, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=3, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.2, p.max=3, col="black")
help(plot)
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=3, col="black"len=0.9)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=3, col="black",len=0.9)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=3, col="black",len=0.2)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=3, col="black",scaling =2)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=3, col="black")
help(strwidth)
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=3, col="black", )
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=1, col="black", )
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=1, col="black", )
#-------------------------
sites_data <- as.data.frame(model_leaf_traits_dbrda_scores$sites[,c(1:2)])
sites_data$labels <- rownames(model_leaf_traits_dbrda_scores$sites)
sites_data$color <- species_colors_samples_leaf
# Calculate the importance values
importance <- as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",]
# Create the ggplot
p <- ggplot() +
geom_point(data = sites_data, aes(x = V1, y = V2, color = color), size = 3) +
scale_color_identity() +
labs(
x = paste0("dbRDA1 (", round(importance[1] * 100, 2), "%)"),
y = paste0("dbRDA2 (", round(importance[2] * 100, 2), "%)"),
title = "dbRDA"
) +
theme_minimal()
# Add legend
p <- p + theme(legend.position = "bottomleft") +
guides(color = guide_legend(override.aes = list(size = 3))) +
scale_color_manual(values = species_colors, labels = species)
# Plot environmental descriptors
p <- p + geom_segment(data = as.data.frame(model_leaf_traits_dbrda_ef_descriptors),
aes(x = 0, y = 0, xend = V1, yend = V2),
arrow = arrow(length = unit(0.2, "cm")), color = "black")
# Print the plot
print(p)
#-------------------------
# Prepare the data
sites_data <- as.data.frame(model_leaf_traits_dbrda_scores$sites[,c(1:2)])
colnames(sites_data) <- c("dbRDA1", "dbRDA2")
sites_data$labels <- rownames(model_leaf_traits_dbrda_scores$sites)
sites_data$color <- species_colors_samples_leaf
# Calculate the importance values
importance <- as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",]
# Create the ggplot
p <- ggplot(sites_data, aes(x = dbRDA1, y = dbRDA2)) +
geom_point(aes(color = color), size = 3) +
scale_color_identity() +
labs(
x = paste0("dbRDA1 (", round(importance[1] * 100, 2), "%)"),
y = paste0("dbRDA2 (", round(importance[2] * 100, 2), "%)"),
title = "dbRDA"
) +
theme_minimal() +
theme(legend.position = "bottomleft") +
guides(color = guide_legend(override.aes = list(size = 3))) +
scale_color_manual(values = species_colors, labels = species) +
geom_text(aes(label = labels), hjust = 0, vjust = 1, size = 3)
# Plot environmental descriptors
ef_data <- as.data.frame(model_leaf_traits_dbrda_ef_descriptors)
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=1, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=0.9, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.3, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=0.9, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=0.9, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=0.8, col="black")
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=0.7, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=1.1, p.max=0.7, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.7, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.8, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black")
# Plot dbRDA
plot(model_leaf_traits_rda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_rda_scores$sites[,1])-1, max(model_leaf_traits_rda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_rda_scores$sites[,2]), max(model_leaf_traits_rda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_rda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_rda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA der bioklimatischen Eigenschaften")
#text(model_leaf_traits_rda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_rda_ef, cex=0.75, p.max=1, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.8, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black")
# Plot dbRDA
plot(model_leaf_traits_rda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_rda_scores$sites[,1])-1, max(model_leaf_traits_rda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_rda_scores$sites[,2]), max(model_leaf_traits_rda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_rda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_rda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA der bioklimatischen Eigenschaften")
#text(model_leaf_traits_rda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_rda_ef, cex=0.75, p.max=1, col="black")
# Model with intercept only
model_0_leaf_traits_rda <- vegan::dbrda(formula=scale(leaf_traits[,8:36]) ~ 1, data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
# Model with all explanatory variables
model_1_leaf_traits_rda <- vegan::dbrda(formula=scale(leaf_traits[,8:36]) ~ ., data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
# Stepwise forward selection
model_step_leaf_traits_rda <- ordistep(object=model_0_leaf_traits_rda, scope=formula(model_1_leaf_traits_rda), R2scope=TRUE, trace=TRUE, Pin=0.05, Pout=0.5, direction="forward", perm.max=10000)
model_step_leaf_traits_rda_scores <- vegan::scores(model_step_leaf_traits_rda)
# dbRDA with selected model by permutation tests in constrained ordination
model_leaf_traits_rda <- vegan::dbrda(formula=as.formula(model_step_leaf_traits_rda$terms), data=bet_traits_rda_y, distance="euclidian", metaMDSdist=FALSE, add=TRUE, sqrt.dist=FALSE)
model_leaf_traits_rda_ef_formula <- update(as.formula(model_step_leaf_traits_rda$terms), model_leaf_traits_rda ~ .)
model_leaf_traits_rda_ef_factors <- as.factor(sapply(strsplit(as.character(model_leaf_traits_rda_ef_formula)[[3]], "\\+"), function(x) { x <- gsub("(\\`|^ | $)","",x) }))
model_leaf_traits_rda_ef <- envfit(formula=model_leaf_traits_rda_ef_formula, data=bet_traits_rda_y, choices=c(1:2), perm=10000)
model_leaf_traits_rda_scores <- vegan::scores(model_leaf_traits_rda, choices=c(1:2))
# Goodness of fit statistic: Squared correlation coefficient
model_leaf_traits_rda_fit <- data.frame(r2=c(model_leaf_traits_rda_ef$vectors$r,model_leaf_traits_rda_ef$factors$r),
pvals=c(model_leaf_traits_rda_ef$vectors$pvals,model_leaf_traits_rda_ef$factors$pvals) )
rownames(model_leaf_traits_rda_fit) <- c(names(model_leaf_traits_rda_ef$vectors$r),names(model_leaf_traits_rda_ef$factors$r))
model_leaf_traits_rda_fit
# Plot dbRDA
plot(model_leaf_traits_rda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_rda_scores$sites[,1])-1, max(model_leaf_traits_rda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_rda_scores$sites[,2]), max(model_leaf_traits_rda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_rda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_rda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA der bioklimatischen Eigenschaften")
#text(model_leaf_traits_rda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_rda_ef, cex=0.75, p.max=1, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.8, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black")
# Plot dbRDA
plot(model_leaf_traits_dbrda_scores$sites[,c(1:2)],
xlim=c(min(model_leaf_traits_dbrda_scores$sites[,1])-1, max(model_leaf_traits_dbrda_scores$sites[,1])+1),
ylim=c(min(model_leaf_traits_dbrda_scores$sites[,2]), max(model_leaf_traits_dbrda_scores$sites[,2])),
xlab=paste0("dbRDA1 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(1)]*100,2),"%)"),
ylab=paste0("dbRDA2 (",round(as.data.frame(summary(model_leaf_traits_dbrda)$cont$importance)["Proportion Explained",c(2)]*100,2),"%)"),
pch=19, col=species_colors_samples_leaf,
main="dbRDA der bioklimatischen Eigenschaften")
legend("bottomleft", bty="n", legend=species, pch=19, col=species_colors, pt.cex=1.4, cex=1, y.intersp=0.8, text.width=0.1)
#text(model_leaf_traits_dbrda_scores$sites[,c(1:2)], display="sites", labels=rownames(leaf_traits), col=species_colors_samples_leaf, pos=3, cex=0.5)
plot(model_leaf_traits_dbrda_ef_descriptors, cex=0.9, p.max=1, col="black")
